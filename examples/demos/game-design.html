<html>
	<head>
		<title>NEJS 2016 - Game Design</title>

		<style>
		body {
			height: 100%;
			width: 100%;
			margin: 0;
			background: #777;
		}

		.character {
			width: 50px;
			height: 50px;
			background: white;
			position: absolute;
			top: 0;
			left: 0;
			z-index: 1;
			transition: .3s;
		}

		.target {
			width: 50px;
			height: 50px;
			background: black;
			position: absolute;
			bottom: 0;
			right: 0;
			z-index: 2;
		}
		</style>
	</head>
	<body>

		<div data-character class="character"></div>
		<div data-target class="target"></div>

		<script>
			// create web audio context
			const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

			// DOM nodes
			const ui = {
				character: document.querySelector('[data-character]'),
				target: document.querySelector('[data-target]'),
			};

			const targetPosition = {
				top: Number(ui.character.style.top.replace(/px/, '')),
				left: window.innerWidth - 50,
			};

			const notes = [
				[261.63, 523.26, 1046.52],
				[293.66, 587.32, 1174.64],
				[311.13, 622.26, 1244.52],
				[392, 784, 1568],
			];

			const gainNode = audioCtx.createGain();
			gainNode.gain.value = .8;

			// create oscillators
			const oscillators = {
				low: audioCtx.createOscillator(),
				mid: audioCtx.createOscillator(),
				high: audioCtx.createOscillator(),
			};

			let currentNote = 0;
			let speed = window.innerWidth;

			oscillators.low.type = 'sine';
			oscillators.low.frequency.value = notes[0][0];

			oscillators.mid.type = 'sine';
			oscillators.mid.frequency.value = notes[0][1];

			oscillators.high.type = 'sine';
			oscillators.high.frequency.value = notes[0][2];

			oscillators.low.connect(gainNode);
			oscillators.mid.connect(gainNode);
			oscillators.high.connect(gainNode);
			gainNode.connect(audioCtx.destination);

			oscillators.low.start(0);
			oscillators.mid.start(0);
			oscillators.high.start(0);

			function note() {
				oscillators.low.frequency.value = notes[currentNote][0];
				oscillators.mid.frequency.value = notes[currentNote][1];
				oscillators.high.frequency.value = notes[currentNote][2];

				if (currentNote >= notes.length - 1) {
					currentNote = 0;
				} else {
					currentNote++;
				}

				setTimeout(note, speed);
			}

			note();

			// move baddy on key down
			document.addEventListener('keydown', e => {

				// calculate current position
				const coords = {
					top: Number(ui.character.style.top.replace(/px/, '')),
					left: Number(ui.character.style.left.replace(/px/, '')),
				};

				switch(e.keyCode) {
					// left
					case 37:
						ui.character.style.left = `${coords.left - 20}px`;
					break;

					// up
					case 38:
						ui.character.style.top = `${coords.top - 20}px`;
					break;

					// right
					case 39:
						ui.character.style.left = `${coords.left + 20}px`;
					break;

					// down
					case 40:
						ui.character.style.top = `${coords.top + 20}px`;
					break;
				}

				console.log(targetPosition.left, coords.left);

				speed = targetPosition.left - coords.left;
			});

		</script>
	</body>
</html>
